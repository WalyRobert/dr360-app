<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DR 360¬∞ - Dodge Recian</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; background: #000; color: #fff; }
        #app { width: 100vw; height: 100vh; display: flex; flex-direction: column; }
        #canvas { width: 100%; flex: 1; display: block; }
        .landing { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; background: linear-gradient(135deg, #000 0%, #1a1a1a 100%); }
        .landing h1 { font-size: 5rem; font-weight: bold; background: linear-gradient(90deg, #fff, #D4AF37); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; text-shadow: 0 0 40px rgba(212, 175, 55, 0.3); margin-bottom: 1rem; }
        .landing h2 { color: #D4AF37; font-size: 1.5rem; margin-bottom: 3rem; font-weight: 300; }
        .landing label { background: #D4AF37; color: #000; padding: 1rem 2rem; border-radius: 2rem; cursor: pointer; font-weight: bold; font-size: 1.1rem; transition: all 0.3s; box-shadow: 0 0 30px rgba(212, 175, 55, 0.5); }
        .landing label:hover { transform: scale(1.05); box-shadow: 0 0 50px rgba(212, 175, 55, 0.8); }
        .landing input[type="file"] { display: none; }
        .controls { position: absolute; bottom: 0; left: 0; right: 0; background: linear-gradient(to top, rgba(0,0,0,0.9), transparent); padding: 2rem; display: none; flex-direction: column; gap: 1rem; }
        .controls.show { display: flex; }
        .progress { width: 100%; height: 4px; background: rgba(255,255,255,0.2); cursor: pointer; margin-bottom: 1rem; border-radius: 2px; }
        .progress-bar { height: 100%; background: #D4AF37; width: 0%; transition: width 0.1s; }
        .controls-bar { display: flex; align-items: center; justify-content: space-between; gap: 1rem; }
        .controls-left, .controls-right { display: flex; gap: 1rem; align-items: center; }
        button { background: rgba(212, 175, 55, 0.2); border: 1px solid #D4AF37; color: #fff; padding: 0.75rem 1rem; border-radius: 0.5rem; cursor: pointer; transition: all 0.3s; font-size: 0.9rem; }
        button:hover { background: #D4AF37; color: #000; }
        button.active { background: #D4AF37; color: #000; }
        .time-display { color: #D4AF37; font-size: 0.9rem; min-width: 100px; }
        .hint { position: absolute; top: 2rem; left: 2rem; background: rgba(0,0,0,0.7); padding: 1rem 1.5rem; border-radius: 0.5rem; font-size: 0.9rem; color: #D4AF37; }
    </style>
</head>
<body>
    <div id="app">
        <div class="landing" id="landing">
            <h1>DR 360¬∞</h1>
            <h2>Dodge Recian - Experi√™ncia Imersiva Premium</h2>
            <label>
                üìÑ Carregar V√≠deo 360¬∞
                <input type="file" id="fileInput" accept="video/*" />
            </label>
        </div>
        <canvas id="canvas"></canvas>
        <div class="hint" id="hint" style="display:none">üóÅÔ∏è Arraste para olhar | üì± Toque e arraste
        </div>
        <div class="controls" id="controls">
            <div class="progress" id="progress"><div class="progress-bar" id="progressBar"></div></div>
            <div class="controls-bar">
                <div class="controls-left">
                    <button id="playBtn">‚ñ∂Ô∏è Play</button>
                    <button id="muteBtn">üîä Mute</button>
                    <span class="time-display"><span id="currentTime">0:00</span> / <span id="duration">0:00</span></span>
                </div>
                <div class="controls-right">
                    <button id="viewModeBtn">360¬∞</button>
                    <button id="vrBtn">VR</button>
                    <button id="downloadBtn">#{x2b07} Salvar</button>
                    <button id="fsBtn">Tela Cheia</button>
                </div>
            </div>
        </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        let scene, camera, renderer, video, sphere, controls = { x: 0, y: 0 };
        let isPlaying = false, isMuted = false, isVR = false, viewMode = 360;
        const fileInput = document.getElementById('fileInput');
        const canvas = document.getElementById('canvas');
        const landing = document.getElementById('landing');
        const controlsEl = document.getElementById('controls');
        const hint = document.getElementById('hint');
        
        function init() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            renderer = new THREE.WebGLRenderer({ canvas, antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            
            video = document.createElement('video');
            video.crossOrigin = 'anonymous';
            video.loop = true;
            
            const texture = new THREE.VideoTexture(video);
            const geometry = new THREE.SphereGeometry(250, 60, 40);
            geometry.scale(-1, 1, 1);
            const material = new THREE.MeshBasicMaterial({ map: texture });
            sphere = new THREE.Mesh(geometry, material);
            scene.add(sphere);
            
            document.addEventListener('mousedown', e => { controls.down = true; controls.x = e.clientX; controls.y = e.clientY; });
            document.addEventListener('mousemove', e => {
                if (!controls.down) return;
                controls.lon += (e.clientX - controls.x) * 0.1;
                controls.lat -= (e.clientY - controls.y) * 0.1;
                controls.lat = Math.max(-85, Math.min(85, controls.lat));
                controls.x = e.clientX;
                controls.y = e.clientY;
            });
            document.addEventListener('mouseup', () => { controls.down = false; });
            
            animate();
        }
        
        function animate() {
            requestAnimationFrame(animate);
            const phi = THREE.MathUtils.degToRad(90 - (controls.lat || 0));
            const theta = THREE.MathUtils.degToRad(controls.lon || 0);
            camera.position.x = 100 * Math.sin(phi) * Math.cos(theta);
            camera.position.y = 100 * Math.cos(phi);
            camera.position.z = 100 * Math.sin(phi) * Math.sin(theta);
            camera.lookAt(scene.position);
            renderer.render(scene, camera);
        }
        
        fileInput.addEventListener('change', e => {
            const file = e.target.files[0];
            if (file) {
                const url = URL.createObjectURL(file);
                video.src = url;
                video.load();
                landing.style.display = 'none';
                controlsEl.classList.add('show');
                hint.style.display = 'block';
                isPlaying = false;
                document.getElementById('playBtn').textContent = '‚ñ∂Ô∏è Play';
            }
        });
        
        document.getElementById('playBtn').addEventListener('click', () => {
            isPlaying ? video.pause() : video.play();
            isPlaying = !isPlaying;
            document.getElementById('playBtn').textContent = isPlaying ? '‚è∏Ô∏è Pausar' : '‚ñ∂Ô∏è Play';
        });
        
        document.getElementById('muteBtn').addEventListener('click', () => {
            isMuted = !isMuted;
            video.muted = isMuted;
            document.getElementById('muteBtn').textContent = isMuted ? 'üîà Mute' : 'üîä Som';
        });
        
        document.getElementById('downloadBtn').addEventListener('click', () => {
            const a = document.createElement('a');
            a.href = video.src;
            a.download = `video-360-${Date.now()}.mp4`;
            a.click();
        });
        
        document.getElementById('fsBtn').addEventListener('click', () => {
            document.documentElement.requestFullscreen();
        });
        
        video.addEventListener('timeupdate', () => {
            const percent = (video.currentTime / video.duration) * 100;
            document.getElementById('progressBar').style.width = percent + '%';
            document.getElementById('currentTime').textContent = formatTime(video.currentTime);
            document.getElementById('duration').textContent = formatTime(video.duration);
        });
        
        document.getElementById('progress').addEventListener('click', e => {
            const rect = e.target.getBoundingClientRect();
            const percent = (e.clientX - rect.left) / rect.width;
            video.currentTime = percent * video.duration;
        });
        
        function formatTime(seconds) {
            if (!seconds || isNaN(seconds)) return '0:00';
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }
        
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
        
        init();
    </script>
</body>
</html>
